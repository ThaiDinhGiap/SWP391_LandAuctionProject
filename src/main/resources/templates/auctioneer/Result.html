<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8"/>
    <link rel="apple-touch-icon" sizes="76x76" th:href="@{/dashboardStatic/img/apple-icon.png}">
    <link rel="icon" type="image/png" th:href="@{/dashboardStatic/img/favicon.png}">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <title>
        Auction register list
    </title>
    <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, shrink-to-fit=no'
          name='viewport'/>
    <!--     Fonts and icons     -->
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700,200" rel="stylesheet"/>
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css" rel="stylesheet">
    <!-- CSS Files -->
    <!-- CHI SUA CAC DUONG DAN CSS O DUOI DAY -->
    <link th:href="@{/dashboardStatic/css/bootstrap.min.css}" rel="stylesheet"/>
    <link th:href="@{/dashboardStatic/css/paper-dashboard.css?v=2.0.1}" rel="stylesheet"/>
    <!-- CSS Just for demo purpose, don't include it in your project -->
    <link th:href="@{/dashboardStatic/demo/demo.css}" rel="stylesheet"/>
    <!-- Bootstrap -->
    <!--    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">-->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <style>
        .custom-badge {
            font-size: 1.2em;
            padding: 0.5em 1em;
        }
    </style>
</head>


<body class="">
<div class="wrapper ">
    <!--  Side navbar: chua lien ket den cac trang tuy chon cua minh  -->
    <div class="sidebar" data-color="white" data-active-color="danger">
        <div class="logo">
            <!--     Đường dẫn đến web chính của dự án     -->
            <a th:href="@{https://www.creative-tim.com}" class="simple-text logo-mini">
                <!--     Avatar người dùng ở đây     -->
                <div class="logo-image-small">
                    <img th:src="@{/dashboardStatic/img/logo-small.png}">
                </div>
                <!-- <p>CT</p> -->
            </a>
            <!--     Đường dẫn đến web chính của dự án     -->
            <a th:href="@{https://www.creative-tim.com}" class="simple-text logo-normal">
                Bui Minh Chien
                <!--     Thêm logo dự án ở đây     -->
                <!--           <div class="logo-image-big">-->
                <!--            <img src="../assets/img/logo-big.png">-->
                <!--          </div>-->
            </a>
        </div>
        <div class="sidebar-wrapper">
            <ul class="nav">
                <li>
                    <a th:href="@{/auctioneer/dashboard}">
                        <i class="nc-icon nc-bank"></i>
                        <p>Dashboard</p>
                    </a>
                </li>
                <li>
                    <a th:href="@{/auctioneer/awaiting_list}">
                        <i class="nc-icon nc-single-copy-04"></i>
                        <p>Asset awaiting scheduling list</p>
                    </a>
                </li>
                <li>
                    <a th:href="@{/auctioneer/get_auction_list}">
                        <i class="nc-icon nc-bullet-list-67"></i>
                        <p>Auction session list</p>
                    </a>
                </li>
            </ul>
        </div>
    </div>
    <!--  End side navbar  -->
    <div class="main-panel">
        <!-- Top Navbar, SUA TIEU DE TRANG CHO PHU HOP -->
        <nav class="navbar navbar-expand-lg navbar-absolute fixed-top navbar-transparent">
            <div class="container-fluid">
                <span class="navbar-brand">VietLand Auction</span>
            </div>
        </nav>
        <!-- End Top Navbar -->
        <!-- Noi dung cua trang se nam trong phan content nay -->
        <div class="content">
            <div class="row">
                <div class="col-md-12">
                    <div class="card">
                        <div class="card-header">
                            <h4 class="card-title" th:text="'Result of Auction: ' + ${registerList.get(0).auction.auctionName}"></h4>
<!--                            <a th:href="@{/auctioneer/viewAuctionDetai(auctionId=${registerList.get(0).auction.auctionId})}" class="btn btn-light">Return Auction Detail</a>-->
                        </div>
                        <div class="card-body">
                            <!-- Phần hiện nút "Set asset's status" khi trạng thái là "Ongoing" -->
                            <div th:if="${registerList.get(0).auction.asset.assetStatus == 'Ongoing'}" class="d-flex justify-content-center align-items-center mt-3 mb-3">
                                <h5 class="mt-2 mr-3">Set asset's status:</h5>
                                <button class="btn btn-outline-primary mx-2" onclick="markAsSuccessfulSold()">Successful Sold</button>
                                <button class="btn btn-outline-secondary mx-2" onclick="markAsFailedSold()">Failed Sold</button>
                            </div>

                            <!-- Thanh trạng thái khi asset đã được bán hoặc thất bại -->
                            <div th:if="${registerList.get(0).auction.asset.assetStatus == 'Successfully sold' || registerList.get(0).auction.asset.assetStatus == 'Failed sold'}" class="d-flex justify-content-center align-items-center mt-3 mb-3">
                                <h5 class="mt-2 mr-3">Asset Status:</h5>
                                <span th:text="${registerList.get(0).auction.asset.assetStatus}" class="badge badge-success mx-2 custom-badge" th:classappend="${registerList.get(0).auction.asset.assetStatus == 'Failed sold' ? 'badge-danger' : 'badge-success'}"></span>
                            </div>
                            <div class="table-responsive">
                                <table class="table">
                                    <thead class=" text-primary">
                                    <tr>
                                        <th>Id</th>
                                        <th>Auction name</th>
                                        <th>Register name</th>
                                        <th>Nick name</th>
                                        <th>Register status</th>
                                        <th>Purchase status</th>
                                        <th>Deposit status</th>
                                        <th>Result</th>
                                        <th>Rank</th>
                                        <th style="display: none;">Registration time</th>
                                        <th class="text-right">Action</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr th:each="register : ${registerList}">
                                        <td th:text="${register.registerId}"></td>
                                        <td th:text="${register.auction.auctionName.length() > 40 ? register.auction.auctionName.substring(0, 40) + '...' : register.auction.auctionName}"
                                            th:title="${register.auction.auctionName}"></td>
                                        <td th:text="${register.buyer.customer.fullName}"></td>
                                        <td th:text="${register.nickName != null ? register.nickName : 'null'}"></td>
                                        <td th:text="${register.registerStatus != null ? register.registerStatus : 'null'}"></td>
                                        <td th:text="${register.purchaseStatus != null ? register.purchaseStatus : 'null'}"></td>
                                        <td th:text="${register.depositStatus != null ? register.depositStatus : 'null'}"></td>
                                        <td th:text="${register.result != null ? register.result : 'null'}"></td>
                                        <td th:text="${register.rank != null ? register.rank : 'null'}"></td>
                                        <td style="display: none;" th:text="${register.registrationTime}"></td>
                                        <td class="text-right">
                                            <!-- Chỉ hiển thị nút nếu purchaseStatus là "Eligible to purchase" -->
                                            <span th:if="${register.purchaseStatus == 'Eligible to purchase'}">
                                                <button type="button" class="btn btn-sm" onclick="sendScheduleMail(this)">
                                                    <i class="bi bi-send"></i>
                                                </button>
                                                <button type="button" class="btn btn-sm" onclick="cancelRightBuy(this)">
                                                    <i class="bi bi-slash-circle"></i>
                                                </button>
                                            </span>
                                        </td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Het phan noi dung cua trang -->
    </div>
</div>
<!---------------------------------------KHONG DUOC SUA------------------------------------------------------>
<!--   Core JS Files   -->
<script th:src="@{/dashboardStatic/js/core/jquery.min.js}"></script>
<script th:src="@{/dashboardStatic/js/core/popper.min.js}"></script>
<script th:src="@{/dashboardStatic/js/core/bootstrap.min.js}"></script>
<script th:src="@{/dashboardStatic/js/plugins/perfect-scrollbar.jquery.min.js}"></script>
<!-- Chart JS -->
<script th:src="@{/dashboardStatic/js/plugins/chartjs.min.js}"></script>
<!--  Notifications Plugin    -->
<script th:src="@{/dashboardStatic/js/plugins/bootstrap-notify.js}"></script>
<!-- Control Center for Now Ui Dashboard: parallax effects, scripts for the example pages etc -->
<script th:src="@{/dashboardStatic/js/paper-dashboard.min.js?v=2.0.1}" type="text/javascript"></script>
<!-- Paper Dashboard DEMO methods, don't include it in your project! -->
<script th:src="@{/dashboardStatic/demo/demo.js}"></script>
<!--Confirm xoa asset voi nguoi dung-->
<script th:inline="javascript">
    var auctionId = [[${auctionId}]];
</script>
<script>
    function confirmDelete() {
        return confirm("Are you sure you want to delete this asset?");
    }

    function sendScheduleMail(button) {
        // Tìm phần tử tr chứa nút
        const registerRow = button.closest("tr");

        // Lấy giá trị registerId từ ô td đầu tiên
        const registerId = registerRow.querySelector("td").textContent.trim();

        // Confirm action from the user
        if (confirm("Are you sure you want to send the schedule?")) {
            // Perform AJAX request without page reload
            fetch(`/auctioneer/sendScheduleMail?registerId=` + registerId, {
                method: 'POST', // Or 'GET' if your endpoint only requires GET
                headers: {
                    'Content-Type': 'application/json'
                }
            })
                .then(response => {
                    if (response.ok) {
                        alert("Schedule sent successfully!");
                    } else {
                        alert("Failed to send schedule, please try again.");
                    }
                })
                .catch(error => {
                    console.error("An error occurred:", error);
                    alert("An error occurred while sending the schedule.");
                });
        }
    }

    function cancelRightBuy(button) {
        // Tìm phần tử tr chứa nút
        const registerRow = button.closest("tr");

        // Lấy giá trị registerId từ ô td đầu tiên
        const registerId = registerRow.querySelector("td").textContent.trim();

        // Confirm action from the user
        if (confirm("Are you sure you want to cancel this user's right to buy asset?")) {
            // Perform AJAX request without page reload
            fetch(`/auctioneer/cancelRight?registerId=` + registerId, {
                method: 'POST', // Or 'GET' if your endpoint only requires GET
                headers: {
                    'Content-Type': 'application/json'
                }
            })
                .then(response => {
                    if (response.ok) {
                        alert("Cancel right successfully!");
                    } else {
                        alert("Failed to cancel right, please try again.");
                    }
                })
                .catch(error => {
                    console.error("An error occurred:", error);
                    alert("An error occurred while cancel right.");
                });
        }
    }
    // Hàm đánh dấu là Successful Sold
    function markAsSuccessfulSold() {
        if (confirm("Are you sure you want to mark this asset as 'Successful Sold'?")) {
            fetch(`/auctioneer/markAsSuccessfulSold?auctionId=` + auctionId, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
                .then(response => {
                    if (response.ok) {
                        alert("Asset marked as Successful Sold!");
                        // Cập nhật giao diện nếu cần
                    } else {
                        alert("Failed to update status. Please try again.");
                    }
                })
                .catch(error => {
                    console.error("An error occurred:", error);
                    alert("An error occurred while updating the status.");
                });
        }
    }

    // Hàm đánh dấu là Failed Sold
    function markAsFailedSold() {
        if (confirm("Are you sure you want to mark this asset as 'Failed Sold'?")) {
            fetch(`/auctioneer/markAsFailedSold?auctionId=` + auctionId, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
                .then(response => {
                    if (response.ok) {
                        alert("Asset marked as Failed Sold!");
                        // Cập nhật giao diện nếu cần
                    } else {
                        alert("Failed to update status. Please try again.");
                    }
                })
                .catch(error => {
                    console.error("An error occurred:", error);
                    alert("An error occurred while updating the status.");
                });
        }
    }
</script>
</body>


</html>
